$(function(){var K=1,G=10,s=$("#delGoodModal"),y=$("#del-confirm"),F=$("#addGoodModal"),j=$("#addshopModal"),i=$("#addSyncModal"),C=document.getElementById("goodTpl").innerHTML,m=document.getElementById("classTpl").innerHTML,e=document.getElementById("shopTpl").innerHTML,I=document.getElementById("goodModalTpl").innerHTML,p=document.getElementById("shopModalTpl").innerHTML,d=document.getElementById("syncModalTpl").innerHTML,A=document.getElementById("modalTpl").innerHTML;
var g="";var z=true,l=[],u=[],k={list:[]},x={list:[]};var H=true;var J="";var h="";var L=[];$("body").on("click",'[name="selectAll"]',function(){if($(this).is(":checked")){var O=$('[name="selectItem"]:checked');
$.each(O,function(P){if(L.indexOf($(this).val())<0){L.push($(this).val());}});}else{var v=$('[name="selectItem"]');$.each(v,function(Q){var P=L.indexOf($(this).val());
if(P>-1){L.splice(P,1);}});}});$("body").on("click",'[name="selectItem"]',function(){if($(this).is(":checked")){if(L.indexOf($(this).val())<0){L.push($(this).val());
}}else{var v=L.indexOf($(this).val());if(v>-1){L.splice(v,1);}}});function n(v,O){$.getJSON(__BASEURL__+"mshop/store_goods_api/goods_list",{current_page:v||1,page_size:G,title:O},function(T){if(T.success){var P=Math.ceil(+T.data.total/G),R=T.data;
l=T.data.rows;$("#goodTbody").html(template(C,R));var S=[];for(var Q=0;Q<T.data.rows.length;Q++){S.push(T.data.rows[Q].id);}J=S.toString();laypage({cont:"goodPage",pages:P,curr:v||1,skin:"#5aa2e7",first:1,last:P,skip:true,prev:"&lt",next:"&gt",jump:function(U,V){if(!V){n(U.curr);
}}});}});}function f(v){$.getJSON(__BASEURL__+"mshop/store_goods_api/get_sync_record_list",{current_page:v||1,page_size:G},function(Q){if(Q.success){var O=Math.ceil(+Q.data.total/G),P=Q.data;
$("#syncModal").html(template(d,P));laypage({cont:"syncModalPage",pages:O,curr:v||1,skin:"#5aa2e7",first:1,last:O,skip:true,prev:"&lt",next:"&gt",jump:function(R,S){if(!S){f(R.curr);
}}});}});}function w(v,O){$.getJSON(__BASEURL__+"mshop/store_goods_api/goods_list",{current_page:v||1,page_size:G,title:O},function(T){if(T.success){var Q=Math.ceil(+T.data.total/G),S=T.data;
l=T.data.rows;T.data.rows.forEach(function(V,U){if(L.indexOf(V.id)>-1){T.data.rows[U].is_check=true;}});$("#goodModal").html(template(I,T.data));var R=$('[name="selectItem"]').length,P=$('[name="selectItem"]:checked').length;
if(R!==0){if(R==P){$('[name="selectAll"]').prop("checked",true);}else{$('[name="selectAll"]').prop("checked",false);}}laypage({cont:"goodModalPage",pages:Q,curr:v||1,skin:"#5aa2e7",first:1,last:Q,skip:true,prev:"&lt",next:"&gt",jump:function(U,V){if(!V){w(U.curr);
}}});}});}function D(v){s.modal("show").on("shown.bs.modal",function(){y.data("id",v);});$('[name="delType"]').each(function(){var O=$(this).val();if(O==0){$(this).prop("checked",true);
}});}y.on("click",function(){var v=$(this).data("id"),O=$("select option:selected").val(),Q=$("#searchVal").val();var P=$('[name="delType"]:checked').val();
$.post(__BASEURL__+"mshop/store_goods_api/goods_del",autoCsrf({goods_id:v,type:P}),function(R){if(R.success){new Msg({type:"success",msg:"删除成功"});n(K,Q);
}else{new Msg({type:"danger",msg:R.msg});}s.modal("hide");});});function b(){$.getJSON(__BASEURL__+"mshop/shop_api/all_list",{},function(Q){if(Q.success){k.list=Q.data.list;
$("#shopTbody").html(template(e,k));if(k.list.length>0){var P=k.list[0].id;}n(K);var v=[];for(var O=0;O<k.list.length;O++){v.push(k.list[O].id);}h=v.toString();
}});}b();function E(){$.getJSON(__BASEURL__+"mshop/shop_api/all_list",{},function(O){if(O.success){k.list=O.data.list;$("#shopModal").html(template(p,k));
var v=$('[name="selectItem"]:checked');$.each(v,function(P){$(this).prop("checked",false);});}});}function c(){$.getJSON(__BASEURL__+"mshop/items_api/get_all_cate",{},function(v){if(v.success){x.list=v.data;
$("#classTbody").html(template(m,x));}});}c();function B(){var P=$("#select-class option:selected").val(),v=$("#select-shop option:selected").val(),O=$("#searchVal").val();
n(K,O);}function q(){var v=$("#select-shop option:selected").val(),O=$("#searchModalVal").val();w(K,O);}function N(P){var O=$(P),Q=F.data("id"),v=$("#select-shop option:selected").val();
J="";if(L.length<1){new Msg({type:"danger",msg:"请先选择商品"});return false;}J=L.toString();F.modal("hide");j.modal("show");E();}function t(R){var Q=$(R),S=F.data("id"),O=$("#select-shop option:selected").val(),P=$('[name="shopItem"]:checked'),v=[];
h="";if(P.length<1){new Msg({type:"danger",msg:"请先选择分店"});return false;}$.each(P,function(T){v.push($(this).val());});h=v.toString();M();}function r(){var v=$('[name="shopItem"]:checked');
console.info(v.length);$("#shop-number").html(v.length);}$("#shopModal").on("click",'[name="shopAll"]',function(){var v=$(this).is(":checked");$('[name="shopItem"]').each(function(O,R){var Q=$(this),P=Q.prop("disabled");
if(P){Q.prop("checked",false);}else{Q.prop("checked",v);}});$("#shop-number").html($('[name="shopItem"]:checked').length);});function a(){$("#goodModal").html('<tr><td class="text-center" colspan="3">加载中...</td></tr>');
$('[name="selectAll"]').prop("checked",false);F.modal("show");L=[];w(1);}function o(){$("#goodModal").html('<tr><td class="text-center" colspan="5">加载中...</td></tr>');
i.modal("show");f(1);}function M(){$("#sync-btn").prop("disabled",true);$.post(__BASEURL__+"mshop/store_goods_api/sync_goods",autoCsrf({goods_ids:J,shop_ids:h}),function(v){if(v.success){new Msg({type:"success",msg:"同步成功"});
j.modal("hide");n(K);}else{new Msg({type:"danger",msg:v.msg});}L=[];$("#sync-btn").prop("disabled",false);});}window.syncGood=M;window.delGood=D;window.searchVal=B;
window.searchModalVal=q;window.openGoodModal=a;window.batchAddGood=N;window.batchAddShop=t;window.addShopItem=r;window.openSyncModal=o;});