$(function(){function a(){$.getJSON(__BASEURL__+"mshop/shop_area_api/get_all_area",{shop_id:g},function(a){if(a.success){var e={rows:a.data};a.data.length>0&&(_.html(template(u,e)),c.html(template(u,e)))}})}function e(){$.getJSON(__BASEURL__+"mshop/shop_area_api/area_table_list",{shop_id:g,shop_area_id:v,title:w},function(a){if(a.success){var e={rows:a.data};$("#tableCon").html(template(f,e))}})}function t(a){window.location.href=__BASEURL__+"mshop/shop_area/table_detail/"+g+"?table_id="+a}function o(){p.modal("show"),$("#table-form").data("bootstrapValidator").destroy(),$("#table-form").data("bootstrapValidator",null),l()}function n(){p.find(".modal-title").text("添加桌位"),c.val(""),h.val(""),b.val(""),m.data("id",""),o()}function s(){window.open(__BASEURL__+"mshop/shop_area_api/zip_download?shop_id="+g)}function l(){$("#table-form").bootstrapValidator({fields:{table_shop_area:{validators:{notEmpty:{message:"区域不能为空"}}},table_name:{validators:{notEmpty:{message:"桌位名称不能为空"},stringLength:{max:30,message:"桌位名称不得超过30个字符"}}},table_number:{validators:{notEmpty:{message:"建议人数不能为空"}}}}}).on("success.form.bv",function(a){a.preventDefault();var t,o,n=m.data("id"),s=c.val(),l=h.val(),i=b.val();o={shop_area_id:s,name:l,number:i},n?(o.id=n,t=__BASEURL__+"mshop/shop_area_api/area_table_edit"):t=__BASEURL__+"mshop/shop_area_api/area_table_add",m.prop("disabled",!0),$.post(t,autoCsrf(o),function(a){a.success?(new Msg({type:"success",msg:a.msg}),e()):new Msg({type:"danger",msg:a.msg}),m.prop("disabled",!1),p.modal("hide")})})}var i=$("#shop"),_=$("#shop_area"),d=$("#title"),r=$("#btn-search"),p=$("#editTableModal"),m=$("#edit-confirm"),c=$("#table_shop_area"),h=$("#table_name"),b=$("#table_number"),u=document.getElementById("shopAreaTpl").innerHTML,f=document.getElementById("tableTpl").innerHTML,g=i.val(),v=_.val(),w=d.val();a(),e(),l(),_.on("change",function(){v=$(this).val(),e()}),r.on("click",function(){w=d.val(),e()}),window.addTable=n,window.downloadQrcodePkg=s,window.goTableDetail=t});