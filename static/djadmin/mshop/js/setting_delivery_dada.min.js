$(function(){function e(){$.get(__BASEURL__+"mshop/setting_api/shipping_method",function(e){if(e.success){var o=+e.data.shipping;2==o?(c.prop("checked",!0),s(!0)):(c.prop("checked",!1),s(!1))}else console.log(e.msg)})}function s(e){e?(h.show(),f.show(),c.prop("disabled",!0)):(h.hide(),f.hide())}function o(){$.get(__BASEURL__+"mshop/dada_api/info",function(e){if(e.success){if(R=e.data.info,!R)return!1;l.val(R.source_id)}else new Msg({type:"danger",msg:e.msg})})}function t(){$.get(__BASEURL__+"mshop/shop_api/all_list",function(e){e.success?r.html(template(S,e.data)):new Msg({type:"danger",msg:e.msg})})}function a(e){$.getJSON(__BASEURL__+"mshop/dada_api/shop_list",{current_page:e||1,page_size:A},function(s){if(s.success){var o=Math.ceil(+s.data.total/A);$("#dadaShopTbody").html(template(L,s.data)),laypage({cont:"dadaShopPage",pages:o,curr:e||1,skin:"#5aa2e7",first:1,last:o,skip:!0,prev:"&lt",next:"&gt",jump:function(e,s){s||(a(e.curr),k=e.curr)}})}})}function n(){$.get(__BASEURL__+"mshop/dada_api/city_all_list",function(e){e.success?g.html(template(B,e.data)):new Msg({type:"danger",msg:e.msg})})}function i(){_.bootstrapValidator({excluded:[":disabled"],fields:{shop_id:{validators:{notEmpty:{message:"请选择微商城门店"}}},shop_no:{validators:{notEmpty:{message:"达达门店编号不能为空"}}},city_code:{validators:{notEmpty:{message:"请选择订单配送区域"}}}}}).on("success.form.bv",function(e){e.preventDefault();var s=r.val(),o=u.val(),t=g.val(),n=g.find("option:selected").text();b.prop("disabled",!0),$.post(__BASEURL__+"mshop/dada_api/shop_edit",autoCsrf({shop_id:s,shop_no:o,city_code:t,city_name:n}),function(e){e.success?(new Msg({type:"success",msg:"保存成功",delay:1}),a(1)):new Msg({type:"danger",msg:e.msg}),b.prop("disabled",!1),M.modal("hide")})})}function p(e,s,o){_.data("bootstrapValidator").destroy(),_.data("bootstrapValidator",null),i(),M.modal("show"),e?(m.text("编辑门店"),r.val(e).prop("disabled",!0),u.val(s),g.val(o)):(m.text("添加门店"),r.val("").prop("disabled",!1),u.val(""),g.val(""))}function d(){y.show(),E.hide(),l.prop("disabled",!0)}var c=$("#status"),l=$("#source_id"),r=$("#shop_id"),u=$("#shop_no"),_=$("#shop-form"),g=$("#city_code"),m=$("#shop-modal-title"),h=$("#source-form-group"),f=$("#shop-form-group"),y=$("#edit-source"),v=$("#confirm-source"),w=$("#cancel-source"),b=$("#confirm-shop"),E=$("#source-btn-group"),M=$("#editShopModal"),S=document.getElementById("shopTpl").innerHTML,B=document.getElementById("cityTpl").innerHTML,L=document.getElementById("dadaShopTpl").innerHTML,k=1,A=10,R=null;e(),o(),t(),n(),a(),i(),c.on("change",function(){var e=$(this).prop("checked"),o=e?2:0;s(e),$.post(__BASEURL__+"mshop/setting_api/update_shipping_method",autoCsrf({shipping:o}),function(s){s.success?new Msg({type:"success",msg:"修改成功",delay:1}):(new Msg({type:"danger",msg:s.msg}),c.prop("checked",!e))})}),y.on("click",function(){y.hide(),E.show(),l.prop("disabled",!1)}),v.on("click",function(){var e=l.val();$.post(__BASEURL__+"mshop/dada_api/edit",autoCsrf({source_id:e}),function(e){e.success?new Msg({type:"success",msg:"修改成功",delay:1}):(new Msg({type:"danger",msg:e.msg}),l.val(R.source_id)),d()})}),w.on("click",function(){d()}),window.editShop=p});