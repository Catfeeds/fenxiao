$(function(){function e(){$.get(__BASEURL__+"/mshop/prints_api/info2",function(e){if(e.success){var n=e.data.info;n?($('[name="type"][value="'+n.type+'"]').prop("checked",!0),$('[name="times"][value="'+n.times+'"]').prop("checked",!0),i.val(n.print_name),p.val(n.print_deviceno),o.val(n.print_key),t(n.type)):($('[name="type"][value="1"]').prop("checked",!0),$('[name="times"][value="1"]').prop("checked",!0),t(1))}else new Msg({type:"danger",msg:e.msg})})}function t(e){1==e?(r.show(),m.hide()):2==e&&(r.hide(),m.show())}function n(){$("#printer-form").bootstrapValidator({fields:{type:{validators:{notEmpty:{message:"打印机类型不能为空"}}},times:{validators:{notEmpty:{message:"打印联数不能为空"}}},print_name:{validators:{notEmpty:{message:"设备名称不能为空"}}},print_deviceno:{validators:{notEmpty:{message:"设备号码不能为空"}}},print_key:{validators:{notEmpty:{message:"设备秘钥不能为空"}}}}}).on("success.form.bv",function(e){e.preventDefault();var t=+$('[name="type"]:checked').val(),n=+$('[name="times"]:checked').val(),a=i.val(),s=p.val(),r=o.val(),m={type:t,times:n};1==t&&(m.print_name=a,m.print_deviceno=s,m.print_key=r),c.prop("disabled",!0),$.post(__BASEURL__+"mshop/prints_api/save",autoCsrf(m),function(e){e.success?new Msg({type:"success",msg:e.msg}):new Msg({type:"danger",msg:e.msg}),c.prop("disabled",!1)})})}function a(){var e=$("#printer-form").html();s=getLodop(),s.PRINT_INIT("云店宝订单"),s.ADD_PRINT_HTM(0,0,"100%","100%",e),s.SET_PRINT_PAGESIZE(3,570,5,"CreateCustomPage")}var s,i=$("#print_name"),p=$("#print_deviceno"),o=$("#print_key"),r=$("#wifi-print-box"),m=$("#usb-print-test"),c=$("#btn-save");e(),n(),m.on("click",function(){a(),s.PRINT()}),$('[name="type"]').on("change",function(){var e=+$(this).val();t(e)})});