$(function(){function e(){function e(e,t){P=e.format("YYYY-MM-DD")+" - "+t.format("YYYY-MM-DD"),b.val(P),r(1)}b.daterangepicker({startDate:N,endDate:O,maxDate:O,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},e)}function t(e){e?(_.show(),m.prop("disabled",!0)):_.hide()}function a(){$.get(__BASEURL__+"mshop/setting_api/shipping_method",function(e){if(e.success){var a=+e.data.shipping;3==a?(m.prop("checked",!0),t(!0)):(m.prop("checked",!1),t(!1))}else console.log(e.msg)})}function o(){$.get(__BASEURL__+"mshop/dianwoda_api/info",function(e){if(e.success){var t=new Number(e.data.balance).toFixed(2);u.html(t)}else console.log(e.msg)})}function n(){$.get(__BASEURL__+"mshop/shop_api/all_list",function(e){e.success?w.html(template(A,e.data)):new Msg({type:"danger",msg:e.msg})})}function s(e){$.getJSON(__BASEURL__+"mshop/dianwoda_api/shop_list",{current_page:e||1,page_size:z},function(t){if(t.success){var a=Math.ceil(+t.data.total/z);$("#dwdShopTbody").html(template(x,t.data)),laypage({cont:"dwdShopPage",pages:a,curr:e||1,skin:"#5aa2e7",first:1,last:a,skip:!0,prev:"&lt",next:"&gt",jump:function(e,t){t||(s(e.curr),C=e.curr)}})}})}function c(){$.get(__BASEURL__+"mshop/dianwoda_api/city_all_list",function(e){e.success?$("#city_code").html(template(U,e.data)):new Msg({type:"danger",msg:e.msg})})}function i(){f.bootstrapValidator({excluded:[":disabled"],fields:{shop_id:{validators:{notEmpty:{message:"请选择微商城门店"}}},city_code:{validators:{notEmpty:{message:"请选择订单配送区域"}}}}}).on("success.form.bv",function(e){e.preventDefault();var t=w.val(),a=v.val(),o=v.find("option:selected").text();T.prop("disabled",!0),$.post(__BASEURL__+"mshop/dianwoda_api/shop_edit",autoCsrf({shop_id:t,city_code:a,city_name:o}),function(e){e.success?(new Msg({type:"success",msg:"保存成功",delay:1}),s(1)):new Msg({type:"danger",msg:e.msg}),T.prop("disabled",!1),Y.modal("hide")})})}function d(e,t){f.data("bootstrapValidator").destroy(),f.data("bootstrapValidator",null),i(),Y.modal("show"),e?(y.text("编辑门店"),w.val(e).prop("disabled",!0),v.val(t)):(y.text("添加门店"),w.val("").prop("disabled",!1),v.val(""))}function r(e){$.getJSON(__BASEURL__+"mshop/dianwoda_api/report_list",{current_page:e||1,page_size:z,shop_id:J,start_date:P.split(" - ")[0],end_date:P.split(" - ")[1]},function(t){if(t.success){var a=Math.ceil(+t.data.total/z);$("#orderReportTbody").html(template(H,t.data)),laypage({cont:"orderReportPage",pages:a,curr:e||1,skin:"#5aa2e7",first:1,last:a,skip:!0,prev:"&lt",next:"&gt",jump:function(e,t){t||(r(e.curr),j=e.curr)}})}})}function p(e){$.getJSON(__BASEURL__+"mshop/dianwoda_api/deposit_history",{current_page:e||1,page_size:z},function(t){if(t.success){var a=Math.ceil(+t.data.total/z);$("#rechargeRecordTbody").html(template(I,t.data)),laypage({cont:"rechargeRecordPage",pages:a,curr:e||1,skin:"#5aa2e7",first:1,last:a,skip:!0,prev:"&lt",next:"&gt",jump:function(e,t){t||p(e.curr)}})}})}function l(e,t){window.open(__BASEURL__+"mshop/dianwoda_api/daily_statement?date="+e+"&shop_id="+t)}var m=$("#status"),g=$('[name="tab-type"]'),u=$("#account-balance"),_=$(".delivery-con"),h=$("#shop"),f=$("#shop-form"),y=$("#shop-modal-title"),w=$("#shop_id"),v=$("#city_code"),b=$("#create_time"),M=$("#btn-recharge"),L=$("#btn-recharge-record"),R=$("#btn-recharge-success"),Y=($("#shop-form-group"),$("#editShopModal")),S=$("#rechargeModal"),E=$("#rechargeRecordModal"),k=$("#rechargeResultModal"),B=$("#recharge-money"),D=$("#confirm-recharge"),T=$("#confirm-shop"),A=document.getElementById("shopTpl").innerHTML,U=document.getElementById("cityTpl").innerHTML,x=document.getElementById("dwdShopTpl").innerHTML,H=document.getElementById("orderReportTpl").innerHTML,I=document.getElementById("rechargeRecordTpl").innerHTML,N=moment().subtract(29,"days"),O=moment(),C=1,j=1,z=10,J=h.val(),P=N.format("YYYY-MM-DD")+" - "+O.format("YYYY-MM-DD");e(),a(),o(),n(),c(),s(),r(),i(),m.on("change",function(){var e=$(this).prop("checked"),a=e?3:0;t(e),$.post(__BASEURL__+"mshop/setting_api/update_shipping_method",autoCsrf({shipping:a}),function(t){t.success?new Msg({type:"success",msg:"修改成功",delay:1}):(new Msg({type:"danger",msg:t.msg}),m.prop("checked",!e))})}),g.on("change",function(){var e=$(this).val();$(".tab-content").hide(),$("#"+e).show()}),h.on("change",function(){J=h.val(),r(1)}),M.on("click",function(){B.val(""),S.modal("show")}),L.on("click",function(){E.modal("show"),p()}),B.on("keyup",function(){var e=B.val().replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3");B.val(e)}),D.on("click",function(){var e=B.val();return""===e?(new Msg({type:"danger",msg:"请输入充值金额"}),!1):+e<1?(new Msg({type:"danger",msg:"充值金额不得低于1元"}),!1):(S.modal("hide"),k.modal("show"),void window.parent.open(__BASEURL__+"alipay/dianwoda?amount="+e))}),R.on("click",function(){k.modal("hide"),window.location.reload()}),window.editShop=d,window.downloadOrderDetail=l});