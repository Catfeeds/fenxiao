$(function(){function e(e){e?(c.show(),n.prop("disabled",!0)):c.hide()}function a(){$.get(__BASEURL__+"mshop/setting_api/shipping_method",function(a){if(a.success){var t=+a.data.shipping;5==t?(n.prop("checked",!0),e(!0)):(n.prop("checked",!1),e(!1))}else console.log(a.msg)})}function t(e){$.getJSON(__BASEURL__+"mshop/fengda_api/money_list",{current_page:e||1,page_size:f},function(a){if(a.success){var n=Math.ceil(+a.data.total/f);o.html(a.data.money),p.html(template(h,a.data)),laypage({cont:"accountPage",pages:n,curr:e||1,skin:"#5aa2e7",first:1,last:n,skip:!0,prev:"&lt",next:"&gt",jump:function(e,a){a||(t(e.curr),_=e.curr)}})}})}var n=$("#status"),c=$(".delivery-con"),o=$("#account-balance"),p=$("#accountTbody"),s=$("#btn-recharge"),r=$("#confirm-recharge"),i=$("#recharge-money"),d=$("#rechargeModal"),g=$("#payModal"),l=$("#pay-type"),u=$("#pay-amount"),m=$("#pay-qrcode"),h=document.getElementById("accountTpl").innerHTML,_=1,f=10;a(),t(),n.on("change",function(){var a=$(this).prop("checked"),t=a?5:0;$.post(__BASEURL__+"mshop/setting_api/update_shipping_method",autoCsrf({shipping:t}),function(t){t.success?(new Msg({type:"success",msg:"修改成功"}),e(a)):(new Msg({type:"danger",msg:t.msg}),n.prop("checked",!a))})}),s.on("click",function(){$('[name="recharge_type"][value=1]').prop("checked",!0),i.val(""),d.modal("show")}),i.on("keyup",function(){var e=i.val().replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3");i.val(e)}),r.on("click",function(){var e=$('[name="recharge_type"]:checked').val(),a=i.val();return""===a?(new Msg({type:"danger",msg:"请输入充值金额"}),!1):+a<1?(new Msg({type:"danger",msg:"充值金额不得低于1元"}),!1):(r.prop("disabled",!0).text("正在获取二维码..."),void $.post(__BASEURL__+"mshop/fengda_api/recharge",autoCsrf({type:e,amount:a}),function(e){r.prop("disabled",!1).text("去支付"),e.success?(m.attr("src","http://demo.waimaishop.com/djadmin/qr_api/index?s=6&d="+e.data.info.pay_link),l.text("1"==e.data.info.type?"微信扫一扫":"支付宝扫一扫"),u.text("￥"+parseFloat(e.data.info.amount).toFixed(2)),d.modal("hide"),g.modal("show")):new Msg({type:"danger",msg:e.msg})}))})});