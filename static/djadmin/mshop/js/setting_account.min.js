$(function(){function t(){$.getJSON(__BASEURL__+"/erp_api/get_login_url",{},function(t){if(t.success){var o=t.data;o&&$("#work_url").attr("href",o.url)}else new Msg({type:"danger",msg:t.msg})})}function o(t){$.getJSON(__BASEURL__+"mshop/account_api/list",{current_page:t||1,page_size:b},function(a){if(a.success){var e=a.data,n=Math.ceil(+a.data.total/b);$("#accountTbody").html(template(h,e)),laypage({cont:"accountPage",pages:n,curr:t||1,skin:"#5aa2e7",first:1,last:n,skip:!0,prev:"&lt",next:"&gt",jump:function(t,a){a||(o(t.curr),y=t.curr)}})}else new Msg({type:"danger",msg:a.msg})})}function a(){l.html('<option value="">请选择</option>'),$.getJSON(__BASEURL__+"erp_api/get_nobind_users",function(t){if(t.success){var o=t.data;l.html(template(w,{list:o}))}else new Msg({type:"danger",msg:t.msg})})}function e(){p.html('<option value="">请选择</option>'),$.getJSON(__BASEURL__+"mshop/shop_api/all_nobind_list",function(t){if(t.success){var o=t.data;p.html(template(v,o))}else new Msg({type:"danger",msg:t.msg})})}function n(){a(),e(),i(),g.find(".modal-title").text("添加子账号"),g.modal("show"),_.data("id","").prop("diabled",!1),l.val("").show(),u.text("--").hide(),p.val("")}function s(t,o,a){e(),i(),g.find(".modal-title").text("编辑子账号"),g.modal("show"),_.data("id",t).prop("diabled",!1),l.hide().val(""),u.show().text(o),p.val("")}function c(t){m.modal("show"),r.data("id",t).prop("diabled",!1)}function i(){f.data("bootstrapValidator").destroy(),f.data("bootstrapValidator",null),d()}function d(){f.bootstrapValidator({fields:{account_work:{validators:{notEmpty:{message:"请选择管理员(员工)"}}},account_shop:{validators:{notEmpty:{message:"请选择管理门店"}}}}}).on("success.form.bv",function(t){t.preventDefault();var a=_.data("id"),e=l.val(),n=p.val(),s={shop_id:n};a?post_url=__BASEURL__+"mshop/account_api/edit?account_id="+a:(s.user_id=e,post_url=__BASEURL__+"mshop/account_api/add"),_.prop("disabled",!0),$.post(post_url,autoCsrf(s),function(t){_.prop("disabled",!1),g.modal("hide"),t.success?(new Msg({type:"success",msg:t.msg}),o(y)):new Msg({type:"danger",msg:t.msg})})})}var l=$("#account_work"),u=$("#account_work_name"),p=$("#account_shop"),r=$("#del-confirm"),_=$("#edit-confirm"),m=$("#delAccountModal"),g=$("#editAccountModal"),f=$("#account-form"),h=document.getElementById("accountTpl").innerHTML,w=document.getElementById("accountWorkTpl").innerHTML,v=document.getElementById("accountShopTpl").innerHTML,y=1,b=10;t(),o(),d(),r.on("click",function(){var t=$(this).data("id");r.prop("disabled",!0),$.post(__BASEURL__+"mshop/account_api/del",autoCsrf({account_id:t}),function(t){r.prop("disabled",!1),m.modal("hide"),t.success?(new Msg({type:"success",msg:"删除成功"}),o(y)):new Msg({type:"danger",msg:t.msg})})}),window.addAccount=n,window.editAccount=s,window.delAccount=c});