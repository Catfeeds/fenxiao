$(function(){function a(){function a(a,s){l=a.format("YYYY-MM-DD")+" - "+s.format("YYYY-MM-DD"),n.val(l),t()}n.daterangepicker({startDate:c,endDate:d,maxDate:d,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},a)}function t(){$.get(__BASEURL__+"mshop/statistics_api/flow_info",{shop_id:p,time:l},function(a){if(a.success){var t=l===moment().format("YYYY-MM-DD")+" - "+moment().format("YYYY-MM-DD"),s=$("#compare-uv"),e=parseInt(a.data.c_uv)-parseInt(a.data.y_uv);$("#uv").text(a.data.c_uv),t?e<0?s.html('<span class="iconfont icon-down"></span>'+Math.abs(e)).addClass("text-danger"):s.html('<span class="iconfont icon-up"></span>'+e).addClass("text-success"):s.html("--").removeClass("text-danger text-success");var n=$("#compare-order-num"),o=parseInt(a.data.c_order_user)-parseInt(a.data.y_order_user);$("#order-num").text(a.data.c_order_user),t?o<0?n.html('<span class="iconfont icon-down"></span>'+Math.abs(o)).addClass("text-danger"):n.html('<span class="iconfont icon-up"></span>'+o).addClass("text-success"):n.html("--").removeClass("text-danger text-success");var r=$("#compare-order-money"),c=parseFloat(a.data.c_order_money)-parseFloat(a.data.y_order_money);$("#order-money").text(a.data.c_order_money),t?c<0?r.html('<span class="iconfont icon-down"></span>￥'+Math.abs(c).toFixed(2)).addClass("text-danger"):r.html('<span class="iconfont icon-up"></span>￥'+c.toFixed(2)).addClass("text-success"):r.html("￥-.--").removeClass("text-danger text-success");var d=$("#compare-pay-num"),p=parseInt(a.data.c_pay_order_user)-parseInt(a.data.y_pay_order_user);$("#pay-num").text(a.data.c_pay_order_user),t?p<0?d.html('<span class="iconfont icon-down"></span>'+Math.abs(p)).addClass("text-danger"):d.html('<span class="iconfont icon-up"></span>'+p).addClass("text-success"):d.html("--").removeClass("text-danger text-success");var m=$("#compare-pay-money"),i=parseFloat(a.data.c_pay_order_money)-parseFloat(a.data.y_pay_order_money);$("#pay-money").text(a.data.c_pay_order_money),t?i<0?m.html('<span class="iconfont icon-down"></span>￥'+Math.abs(i).toFixed(2)).addClass("text-danger"):m.html('<span class="iconfont icon-up"></span>￥'+i.toFixed(2)).addClass("text-success"):m.html("￥-.--").removeClass("text-danger text-success");var _=$("#compare-customer-unit-price"),u=parseFloat(a.data.c_guest_unit_price)-parseFloat(a.data.y_guest_unit_price);$("#customer-unit-price").text(a.data.c_guest_unit_price),t?u<0?_.html('<span class="iconfont icon-down"></span>￥'+Math.abs(u).toFixed(2)).addClass("text-danger"):_.html('<span class="iconfont icon-up"></span>￥'+u.toFixed(2)).addClass("text-success"):_.html("￥-.--").removeClass("text-danger text-success");var x=$("#compare-order-conversion-rate"),y=parseFloat(a.data.c_turn_order_rate)-parseFloat(a.data.y_turn_order_rate);$("#order-conversion-rate").text(a.data.c_turn_order_rate),t?y<0?x.html('<span class="iconfont icon-down"></span>'+Math.abs(y).toFixed(2)+"%").addClass("text-danger"):x.html('<span class="iconfont icon-up"></span>'+y.toFixed(2)+"%").addClass("text-success"):x.html("-.--%").removeClass("text-danger text-success");var h=$("#compare-pay-conversion-rate"),f=parseFloat(a.data.c_turn_pay_order_rate)-parseFloat(a.data.y_turn_pay_order_rate);$("#pay-conversion-rate").text(a.data.c_turn_pay_order_rate),t?f<0?h.html('<span class="iconfont icon-down"></span>'+Math.abs(f).toFixed(2)+"%").addClass("text-danger"):h.html('<span class="iconfont icon-up"></span>'+f.toFixed(2)+"%").addClass("text-success"):h.html("-.--%").removeClass("text-danger text-success");var g=$("#compare-shop-conversion-rate"),v=parseFloat(a.data.c_turn_shop_rate)-parseFloat(a.data.y_turn_shop_rate);$("#shop-conversion-rate").text(a.data.c_turn_shop_rate),t?v<0?g.html('<span class="iconfont icon-down"></span>'+Math.abs(v).toFixed(2)+"%").addClass("text-danger"):g.html('<span class="iconfont icon-up"></span>'+v.toFixed(2)+"%").addClass("text-success"):g.html("-.--%").removeClass("text-danger text-success")}else new Msg({type:"danger",msg:a.msg})})}function s(){$.get(__BASEURL__+"mshop/statistics_api/get_flow_shop_statistic_data",{rank_type:m},function(a){a.success&&$("#flowTbody").html(template(r,{rows:a.data,rank_type:m}))})}var e=$("#shop"),n=$("#time"),o=$("#rank_type"),r=document.getElementById("flowTpl").innerHTML,c=moment().subtract(29,"days"),d=moment(),p=e.val(),l=c.format("YYYY-MM-DD")+" - "+d.format("YYYY-MM-DD"),m=1;a(),t(),s(),e.on("change",function(){p=e.val(),t()}),o.on("change",function(){m=o.val(),$("#type-txt").text(o.find("option:selected").text()),s()})});