$(function(){function e(){$.get(__BASEURL__+"mshop/setting_api/shipping_method",function(e){if(e.success){var n=+e.data.shipping;6==n?(t.prop("checked",!0),p(!0)):(t.prop("checked",!1),p(!1))}else console.log(e.msg)})}function p(e){e?(o.show(),t.prop("disabled",!0)):o.hide()}function n(){$.get(__BASEURL__+"mshop/cantingbao_api/info",function(e){if(e.success){if(u=e.data.config,!u)return!1;u.app_key&&c.val(u.app_key),u.app_secret&&i.val(u.app_secret),u.app_key&&u.app_secret?a():s()}else new Msg({type:"danger",msg:e.msg})})}function s(){g.hide(),r.show(),c.prop("disabled",!1),i.prop("disabled",!1)}function a(){g.show(),r.hide(),c.prop("disabled",!0),i.prop("disabled",!0)}var t=$("#status"),c=$("#app_key"),i=$("#app_secret"),o=$("#cantingbao-box"),g=$("#edit-cantingbao"),d=$("#cancel-cantingbao"),_=$("#confirm-cantingbao"),r=$("#cantingbao-btn-group"),u=null;e(),n(),t.on("change",function(){var e=$(this).prop("checked"),n=e?6:0;p(e),$.post(__BASEURL__+"mshop/setting_api/update_shipping_method",autoCsrf({shipping:n}),function(p){p.success?new Msg({type:"success",msg:"修改成功",delay:1}):(new Msg({type:"danger",msg:p.msg}),t.prop("checked",!e))})}),g.on("click",function(){s()}),_.on("click",function(){var e=c.val(),p=i.val();return e?p?(_.prop("disabled",!0).text("保存中..."),void $.post(__BASEURL__+"mshop/cantingbao_api/setting",autoCsrf({app_key:e,app_secret:p}),function(n){_.prop("disabled",!1).text("保存"),n.success?(a(),u.app_key=e,u.app_secret=p,new Msg({type:"success",msg:"修改成功",delay:1})):new Msg({type:"danger",msg:n.msg})})):(new Msg({type:"danger",msg:"商户秘钥不能为空"}),!1):(new Msg({type:"danger",msg:"商户Key不能为空"}),!1)}),d.on("click",function(){a(),_.prop("disabled",!1).text("保存"),u&&(c.val(u.app_key),i.val(u.app_secret))})});