$(function(){function t(a){$.getJSON(__BASEURL__+"mshop/promotion_api/index/2",{shop_id:h,status:m,title:f,current_page:a||1,page_size:_},function(i){if(i.success){for(var n=Math.ceil(+i.data.total/_),e=i.data,o=[],s=0;s<e.rows.length;s++)o=JSON.parse(e.rows[s].setting),e.rows[s].discountList=o;g=e,$("#activeTbody").html(template(p,g));var d=$(".activity_td");d.each(function(t,a){var i=$(a).find("span").last(),n=i.html(),e=n.substring(0,n.length-1);i.html(e)}),laypage({cont:"activePage",pages:n,curr:a||1,skin:"#5aa2e7",first:1,last:n,skip:!0,prev:"&lt",next:"&gt",jump:function(a,i){i||t(a.curr)}})}})}function a(t,a,i){e.modal("show"),s.attr("data_index",a),s.attr("data_id",i)}function i(t,a){n.modal("show"),o.attr("data_id",a)}var n=$("#delActiveModal"),e=$("#endActiveModal"),o=$("#del-confirm"),s=$("#end-confirm"),d=$("#btn-search"),c=$("#active_state"),r=$("#shop"),l=$("#searchVal"),p=document.getElementById("activeTpl").innerHTML,u=1,_=10,h=r.val(),m=c.val(),f=l.val(),g={rows:[]};t(u),r.on("change",function(){h=$(this).val(),t(1)}),c.on("change",function(){m=$(this).val(),t(1)}),d.on("click",function(){f=l.val(),t(1)}),s.on("click",function(){var a=($(this).attr("data_index"),$(this).attr("data_id"));s.prop("disabled",!0),$.post(__BASEURL__+"mshop/promotion_api/close",autoCsrf({id:a}),function(a){a.success?(e.modal("hide"),t(1)):new Msg({type:"danger",msg:a.msg}),s.prop("disabled",!1)})}),o.on("click",function(){var a=$(this).attr("data_id");o.prop("disabled",!0),$.post(__BASEURL__+"mshop/promotion_api/delete",autoCsrf({id:a}),function(a){a.success?(n.modal("hide"),t(1)):new Msg({type:"danger",msg:a.msg}),o.prop("disabled",!1)})}),window.delActive=i,window.endActive=a});