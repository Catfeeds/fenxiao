$(function(){var h=$("#create_time"),q=$("#edit-confirm"),t=$("#editReplyModal"),m=document.getElementById("commentTpl").innerHTML;var i=moment().subtract(29,"days"),f=moment();
var r=1,g=10,e=0,j="",s="",o="",b=i.format("YYYY-MM-DD")+" - "+f.format("YYYY-MM-DD");c();w();d();function c(){j=GetQueryString("reply_type");$('[name="commentTpye"][value="'+j+'"]').prop("checked",true);
}function w(){function x(y,z){b=y.format("YYYY-MM-DD")+" - "+z.format("YYYY-MM-DD");h.val(b);d(1);}h.daterangepicker({startDate:i,endDate:f,maxDate:f,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{今日:[moment(),moment()],昨日:[moment().subtract(1,"days"),moment().subtract(1,"days")],最近7日:[moment().subtract(6,"days"),moment()],最近30日:[moment().subtract(29,"days"),moment()]}},x);
}function d(x){e=$("#select-shop").val();if(!e){e=0;}$.getJSON(__BASEURL__+"mshop/comment_api/comment_list",{shop_id:e,current_page:x||1,page_size:g,time:b,reply_type:j,score:s,is_have:o},function(B){if(B.success){var y=Math.ceil(+B.data.total/g);
var C={rows:[]};C.rows=B.data.rows;for(var A=0;A<B.data.rows.length;A++){if(B.data.rows[A].comments[0].tags){C.rows[A].comments[0].tags=B.data.rows[A].comments[0].tags.split(",");
}else{C.rows[A].comments[0].tags=[];}if(B.data.rows[A].comments[0].picarr){C.rows[A].comments[0].picarr=B.data.rows[A].comments[0].picarr.split(",");for(var z=0;
z<C.rows[A].comments[0].picarr.length;z++){if(C.rows[A].comments[0].picarr[z]){if(C.rows[A].comments[0].picarr[z].indexOf("http")>-1){C.rows[A].comments[0].picarr[z]=C.rows[A].comments[0].picarr[z];
}else{C.rows[A].comments[0].picarr[z]=__UPLOADURL__+C.rows[A].comments[0].picarr[z];}}else{C.rows[A].comments[0].picarr[z]=[];}}}else{C.rows[A].comments[0].picarr=[];
}}console.info(C);$("#commentTbody").html(template(m,C));laypage({cont:"commentPage",pages:y,curr:x||1,skin:"#5aa2e7",first:1,last:y,skip:true,prev:"&lt",next:"&gt",jump:function(D,E){if(!E){d(D.curr);
r=D.curr;}}});}});}function l(){e=$("#select-shop").val();d(1);}$("body").on("click",'[name="commentTpye"]',function(){var x=$(this).val();$(this).prop("checked",true);
if(x==0){j="";}else{if(x==1){j=1;}}d(1);});$("body").on("click",'[name="hasContent"]',function(){if($(this).is(":checked")){o=1;}else{o="";}d(1);});function k(x){a();
$("#reply_name").val("");q.data("id",x);}function a(){t.modal("show");$("#reply-form").data("bootstrapValidator").destroy();$("#reply-form").data("bootstrapValidator",null);
n();}n();function n(){$("#reply-form").bootstrapValidator({fields:{reply_name:{validators:{notEmpty:{message:"回复内容不能为空"}}}}}).on("success.form.bv",function(y){y.preventDefault();
var A=q.data("id"),x=$("#reply_name").val(),z;z={order_id:A,content:x};post_url=__BASEURL__+"mshop/comment_api/reply";q.prop("disabled",true);$.post(post_url,autoCsrf(z),function(B){if(B.success){new Msg({type:"success",msg:B.msg});
d(r);}else{new Msg({type:"danger",msg:B.msg});}q.prop("disabled",false);t.modal("hide");});});}function v(y,x){$.post(__BASEURL__+"mshop/comment_api/hide",autoCsrf({order_id:y,is_hide:x}),function(z){if(z.success){new Msg({type:"success",msg:z.msg});
d(1);}else{new Msg({type:"danger",msg:z.msg});}});}function p(x){var y=$(x).find("input").val();j=y;d(1);}function u(x){var y=$(x).find("input").val();
s=y;d(1);}window.changeScore=u;window.changeReply=p;window.changeHide=v;window.reply=k;window.changeShop=l;});