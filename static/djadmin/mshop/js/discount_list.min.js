$(function(){function t(a){$.getJSON(__BASEURL__+"mshop/promotion_api/index/1",{status:h,shop_id:m,title:f,current_page:a||1,page_size:_},function(s){if(s.success){for(var e=Math.ceil(+s.data.total/_),o=s.data,i="",n=0;n<o.rows.length;n++)1==o.rows[n].status&&(i="未开始",o.rows[n].statusName=i),2==o.rows[n].status&&(i="进行中",o.rows[n].statusName=i),3==o.rows[n].status&&(i="已结束",o.rows[n].statusName=i);$("#activeTbody").html(template(p,o)),laypage({cont:"activePage",pages:e,curr:a||1,skin:"#5aa2e7",first:1,last:e,skip:!0,prev:"&lt",next:"&gt",jump:function(a,s){s||t(a.curr)}})}})}function a(t,a,s){o.modal("show"),n.attr("data_index",a),n.attr("data_id",s)}function s(t,a){e.modal("show"),i.attr("data_id",a)}var e=$("#delActiveModal"),o=$("#endActiveModal"),i=$("#del-confirm"),n=$("#end-confirm"),d=$("#btn-search"),c=$("#active_state"),r=$("#shop"),l=$("#searchVal"),p=document.getElementById("activeTpl").innerHTML,u=1,_=10,m=r.val(),h=c.val(),f=l.val();t(u),r.on("change",function(){m=$(this).val(),t(1)}),c.on("change",function(){h=$(this).val(),t(1)}),d.on("click",function(){f=l.val(),t(1)}),n.on("click",function(){var a=($(this).attr("data_index"),$(this).attr("data_id"));n.prop("disabled",!0),$.post(__BASEURL__+"mshop/promotion_api/close",autoCsrf({id:a}),function(a){a.success?(o.modal("hide"),t(1)):new Msg({type:"danger",msg:a.msg}),n.prop("disabled",!1)})}),i.on("click",function(){var a=$(this).attr("data_id");i.prop("disabled",!0),$.post(__BASEURL__+"mshop/promotion_api/delete",autoCsrf({id:a}),function(a){a.success?(e.modal("hide"),t(1)):new Msg({type:"danger",msg:a.msg}),i.prop("disabled",!1)})}),window.delActive=s,window.endActive=a});