$(function(){function a(){function a(a,e){l=a.format("YYYY-MM-DD")+" - "+e.format("YYYY-MM-DD"),r.val(l),t()}r.daterangepicker({startDate:d,endDate:p,maxDate:p,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},a)}function t(){$.get(__BASEURL__+"mshop/statistics_api/flow_info",{shop_id:m,time:l},function(a){if(a.success){var t=l===moment().format("YYYY-MM-DD")+" - "+moment().format("YYYY-MM-DD"),e=$("#compare-uv"),s=parseInt(a.data.c_uv)-parseInt(a.data.y_uv);$("#uv").text(a.data.c_uv),t?s<0?e.html('<span class="iconfont icon-down"></span>'+Math.abs(s)).addClass("text-danger"):e.html('<span class="iconfont icon-up"></span>'+s).addClass("text-success"):e.html("--").removeClass("text-danger text-success");var n=$("#compare-order-num"),o=parseInt(a.data.c_order_user)-parseInt(a.data.y_order_user);$("#order-num").text(a.data.c_order_user),t?o<0?n.html('<span class="iconfont icon-down"></span>'+Math.abs(o)).addClass("text-danger"):n.html('<span class="iconfont icon-up"></span>'+o).addClass("text-success"):n.html("--").removeClass("text-danger text-success");var r=$("#compare-order-money"),c=parseFloat(a.data.c_order_money)-parseFloat(a.data.y_order_money);$("#order-money").text(a.data.c_order_money),t?c<0?r.html('<span class="iconfont icon-down"></span>￥'+Math.abs(c).toFixed(2)).addClass("text-danger"):r.html('<span class="iconfont icon-up"></span>￥'+c.toFixed(2)).addClass("text-success"):r.html("￥-.--").removeClass("text-danger text-success");var d=$("#compare-pay-num"),p=parseInt(a.data.c_pay_order_user)-parseInt(a.data.y_pay_order_user);$("#pay-num").text(a.data.c_pay_order_user),t?p<0?d.html('<span class="iconfont icon-down"></span>'+Math.abs(p)).addClass("text-danger"):d.html('<span class="iconfont icon-up"></span>'+p).addClass("text-success"):d.html("--").removeClass("text-danger text-success");var m=$("#compare-pay-money"),i=parseFloat(a.data.c_pay_order_money)-parseFloat(a.data.y_pay_order_money);$("#pay-money").text(a.data.c_pay_order_money),t?i<0?m.html('<span class="iconfont icon-down"></span>￥'+Math.abs(i).toFixed(2)).addClass("text-danger"):m.html('<span class="iconfont icon-up"></span>￥'+i.toFixed(2)).addClass("text-success"):m.html("￥-.--").removeClass("text-danger text-success");var u=$("#compare-customer-unit-price"),_=parseFloat(a.data.c_guest_unit_price)-parseFloat(a.data.y_guest_unit_price);$("#customer-unit-price").text(a.data.c_guest_unit_price),t?_<0?u.html('<span class="iconfont icon-down"></span>￥'+Math.abs(_).toFixed(2)).addClass("text-danger"):u.html('<span class="iconfont icon-up"></span>￥'+_.toFixed(2)).addClass("text-success"):u.html("￥-.--").removeClass("text-danger text-success");var y=$("#compare-order-conversion-rate"),x=parseFloat(a.data.c_turn_order_rate)-parseFloat(a.data.y_turn_order_rate);$("#order-conversion-rate").text(a.data.c_turn_order_rate),t?x<0?y.html('<span class="iconfont icon-down"></span>'+Math.abs(x).toFixed(2)+"%").addClass("text-danger"):y.html('<span class="iconfont icon-up"></span>'+x.toFixed(2)+"%").addClass("text-success"):y.html("-.--%").removeClass("text-danger text-success");var h=$("#compare-pay-conversion-rate"),f=parseFloat(a.data.c_turn_pay_order_rate)-parseFloat(a.data.y_turn_pay_order_rate);$("#pay-conversion-rate").text(a.data.c_turn_pay_order_rate),t?f<0?h.html('<span class="iconfont icon-down"></span>'+Math.abs(f).toFixed(2)+"%").addClass("text-danger"):h.html('<span class="iconfont icon-up"></span>'+f.toFixed(2)+"%").addClass("text-success"):h.html("-.--%").removeClass("text-danger text-success");var g=$("#compare-shop-conversion-rate"),v=parseFloat(a.data.c_turn_shop_rate)-parseFloat(a.data.y_turn_shop_rate);$("#shop-conversion-rate").text(a.data.c_turn_shop_rate),t?v<0?g.html('<span class="iconfont icon-down"></span>'+Math.abs(v).toFixed(2)+"%").addClass("text-danger"):g.html('<span class="iconfont icon-up"></span>'+v.toFixed(2)+"%").addClass("text-success"):g.html("-.--%").removeClass("text-danger text-success")}else new Msg({type:"danger",msg:a.msg})})}function e(){$.get(__BASEURL__+"mshop/statistics_api/flow_chart_data",function(a){a.success?n(a.data):new Msg({type:"danger",msg:a.msg})})}function s(){var a={color:["#59A2E7","#F96768","#926EDD","#57C7D3","#FA6197"],title:{text:""},tooltip:{trigger:"axis"},legend:{data:["付款金额","付款人数","下单转化率","付款转化率","全店转化率"]},grid:{left:"2%",right:36,bottom:"2%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:["--","--","--","--","--","--","--"]},yAxis:{type:"value",axisLine:{show:!1}},series:[{name:"付款金额",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"付款人数",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"下单转化率",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"付款转化率",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"全店转化率",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]}]};c.setOption(a)}function n(a){var t=[],e=[],s=[],n=[],o=[],r=[];$.each(a,function(a,c){t[a]=c.date,e[a]=+c.pay_order_money,s[a]=+c.pay_order_user,n[a]=+c.turn_order_rate,o[a]=+c.turn_pay_order_rate,r[a]=+c.turn_shop_rate});var d={xAxis:{type:"category",boundaryGap:!1,data:t},series:[{name:"付款金额",type:"line",smooth:"ture",data:e},{name:"付款人数",type:"line",smooth:"ture",data:s},{name:"下单转化率",type:"line",smooth:"ture",data:n},{name:"付款转化率",type:"line",smooth:"ture",data:o},{name:"全店转化率",type:"line",smooth:"ture",data:r}]};c.setOption(d)}var o=$("#shop"),r=$("#time"),c=echarts.init(document.getElementById("trend-chart")),d=moment().subtract(29,"days"),p=moment(),m=o.val(),l=d.format("YYYY-MM-DD")+" - "+p.format("YYYY-MM-DD");a(),s(),t(),e(),o.on("change",function(){m=o.val(),t()})});