$(function(){function a(){s.find("fieldset").prop("disabled",!1),o.hide(),r.show()}function e(){s.find("fieldset").prop("disabled",!0),o.show(),r.hide()}function i(){s.data("bootstrapValidator").destroy(),s.data("bootstrapValidator",null),t()}function t(){s.bootstrapValidator({fields:{app_id:{validators:{notEmpty:{message:"应用ID不能为空"}}},sign_type:{validators:{notEmpty:{message:"请选择密钥类型"}}},alipay_public_key:{validators:{notEmpty:{message:"支付宝公钥不能为空"}}},merchant_private_key:{validators:{notEmpty:{message:"商户私钥不能为空"}}}}}).on("success.form.bv",function(a){a.preventDefault();var i=n.val(),t=+$('[name="sign_type"]:checked').val(),p=l.val(),s=_.val();c.prop("disabled",!0).text("保存中..."),$.post(__BASEURL__+"mshop/alipay_config_api/pay_edit",autoCsrf({app_id:i,sign_type:t,alipay_public_key:p,merchant_private_key:s}),function(a){c.prop("disabled",!1).text("保存"),a.success?(e(),new Msg({type:"success",msg:a.msg})):new Msg({type:"danger",msg:a.msg})})})}function p(){$.getJSON(__BASEURL__+"mshop/alipay_config_api/info",function(i){if(i.success){var t=i.data.info;if(!t)return void a();t.sign_type&&"null"!==t.sign_type&&$('[name="sign_type"][value='+t.sign_type+"]").prop("checked",!0),t.app_id&&"null"!==t.app_id&&n.val(t.app_id),t.alipay_public_key&&"null"!==t.alipay_public_key&&l.val(t.alipay_public_key),t.merchant_private_key&&"null"!==t.merchant_private_key&&_.text(t.merchant_private_key),t.sign_type&&"null"!==t.sign_type&&t.app_id&&"null"!==t.app_id&&t.alipay_public_key&&"null"!==t.alipay_public_key&&t.merchant_private_key&&"null"!==t.merchant_private_key?e():a()}else a(),new Msg({type:"danger",msg:i.msg})})}var n=$("#app_id"),l=$("#alipay_public_key"),_=$("#merchant_private_key"),s=$("#pay-form"),o=$("#btn-edit-pay"),y=$("#btn-cancel-pay"),c=$("#btn-save-pay"),r=$("#pay-action-box");t(),p(),o.on("click",function(){i(),a()}),y.on("click",function(){i(),e()})});