$(function(){function t(){function t(t,e){h=t.format("YYYY-MM-DD")+" - "+e.format("YYYY-MM-DD"),i.val(h),a()}i.daterangepicker({startDate:u,endDate:p,maxDate:p,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},t)}function e(){function t(t,e){b=t.format("YYYY-MM-DD")+" - "+e.format("YYYY-MM-DD"),c.val(b),r()}c.daterangepicker({startDate:u,endDate:p,maxDate:p,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},t)}function a(){$.get(__BASEURL__+"mshop/statistics_api/money_shop_info",{shop_id:Y,service:f,time:h},function(t){h===moment().format("YYYY-MM-DD")+" - "+moment().format("YYYY-MM-DD");t.success?($("#pay_order_money").text(t.data.pay_order_money),$("#total_discount_money").text(t.data.total_discount_money),$("#member_order_money").text(t.data.member_order_money),$("#tk_order_money").text(t.data.tk_order_money),$("#total_count").text(t.data.total_count),$("#pay_order_count").text(t.data.pay_order_count),$("#tk_order_count").text(t.data.tk_order_count),$("#invalid_order_count").text(t.data.invalid_order_count)):new Msg({type:"danger",msg:t.msg})})}function o(){var t={color:["#e7587e","#dd58e7","#9d58e7","#58a3e7","#58c9e7","#58e79f","#e7b358","#e76a58"],title:{text:""},tooltip:{trigger:"axis"},legend:{data:["营业额","优惠折扣","储值卡消费额","退款金额","订单数","付款订单数","退款订单数","无效订单数"]},grid:{left:"2%",right:36,bottom:"2%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:["--","--","--","--","--","--","--"]},yAxis:{type:"value",axisLine:{show:!1}},series:[{name:"营业额",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"优惠折扣",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"储值卡消费额",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"退款金额",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"订单数",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"付款订单数",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"退款订单数",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]},{name:"无效订单数",type:"line",smooth:"ture",data:[0,0,0,0,0,0,0]}]};l.setOption(t)}function n(){$.get(__BASEURL__+"mshop/statistics_api/money_chart_data",{shop_id:Y,service:f},function(t){t.success?m(t.data):new Msg({type:"danger",msg:t.msg})})}function m(t){var e=[],a=[],o=[],n=[],m=[],r=[],s=[],d=[],i=[];$.each(t,function(t,c){e[t]=c.date,a[t]=+c.pay_order_money,o[t]=+c.total_discount_money,n[t]=+c.member_order_money,m[t]=+c.tk_order_money,r[t]=+c.total_count,s[t]=+c.pay_order_count,d[t]=+c.tk_order_count,i[t]=+c.invalid_order_count});var c={xAxis:{type:"category",boundaryGap:!1,data:e},series:[{name:"营业额",type:"line",smooth:"ture",data:a},{name:"优惠折扣",type:"line",smooth:"ture",data:o},{name:"储值卡消费额",type:"line",smooth:"ture",data:n},{name:"退款金额",type:"line",smooth:"ture",data:m},{name:"订单数",type:"line",smooth:"ture",data:r},{name:"付款订单数",type:"line",smooth:"ture",data:s},{name:"退款订单数",type:"line",smooth:"ture",data:d},{name:"无效订单数",type:"line",smooth:"ture",data:i}]};l.setOption(c)}function r(){$.get(__BASEURL__+"mshop/statistics_api/get_money_shop_statistic_data",{rank_type:D,rank_time:b},function(t){t.success&&$("#tradeTbody").html(template(y,{rows:t.data,rank_type:D}))})}var s=$("#shop"),d=$("#service"),i=$("#time"),c=$("#rank_time"),_=$("#rank_type"),l=echarts.init(document.getElementById("trend-chart")),y=document.getElementById("tradeShopRankTpl").innerHTML,u=moment().subtract(29,"days"),p=moment(),Y=s.val(),f=d.val(),h=u.format("YYYY-MM-DD")+" - "+p.format("YYYY-MM-DD"),b=u.format("YYYY-MM-DD")+" - "+p.format("YYYY-MM-DD"),D=1;t(),e(),a(),o(),n(),r(),s.on("change",function(){Y=s.val(),a(),n()}),d.on("change",function(){f=d.val(),a(),n()}),_.on("change",function(){D=_.val(),$("#type-txt").text(_.find("option:selected").text()),r()})});