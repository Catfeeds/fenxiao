$(function(){function a(e){$.getJSON(__BASEURL__+"mshop/shop_area_api/area_list",{shop_id:f,current_page:e||1,page_size:u},function(t){if(t.success){var o=Math.ceil(+t.data.total/u);$("#areaTbody").html(template(m,t.data)),laypage({cont:"areaPage",pages:o,curr:e||1,skin:"#5aa2e7",first:1,last:o,skip:!0,prev:"&lt",next:"&gt",jump:function(e,t){t||(a(e.curr),_=e.curr)}})}})}function e(){$("#area-form").bootstrapValidator({fields:{name:{validators:{notEmpty:{message:"区域名称不能为空"},stringLength:{max:30,message:"区域名称不得超过30个字符"}}}}}).on("success.form.bv",function(e){e.preventDefault();var t,o,s=l.data("id"),d=r.val();o={name:d,shop_id:f},s?(o.id=s,t=__BASEURL__+"mshop/shop_area_api/area_edit"):t=__BASEURL__+"mshop/shop_area_api/area_add",l.prop("disabled",!0),$.post(t,autoCsrf(o),function(e){e.success?(new Msg({type:"success",msg:e.msg}),a(1)):new Msg({type:"danger",msg:e.msg}),l.prop("disabled",!1),n.modal("hide")})})}function t(){n.modal("show"),$("#area-form").data("bootstrapValidator").destroy(),$("#area-form").data("bootstrapValidator",null),e()}function o(){t(),n.find(".modal-title").text("添加区域"),r.val(""),l.data("id","")}function s(a,e){t(),n.find(".modal-title").text("编辑区域"),r.val(e),l.data("id",a)}function d(a){p.modal("show"),c.data("id",a)}var i=$("#shop"),r=$("#name"),n=$("#editAreaModal"),p=$("#delAreaModal"),l=$("#edit-confirm"),c=$("#del-confirm"),m=($("#areaTbody"),document.getElementById("areaTpl").innerHTML),_=1,u=10,f=i.val();a(),e(),c.on("click",function(){var e=$(this).data("id");c.prop("disabled",!0),$.post(__BASEURL__+"mshop/shop_area_api/area_del",autoCsrf({id:e}),function(e){e.success?(new Msg({type:"success",msg:"删除成功"}),a(1)):new Msg({type:"danger",msg:e.msg}),c.prop("disabled",!1),p.modal("hide")})}),window.addArea=o,window.editArea=s,window.delArea=d});