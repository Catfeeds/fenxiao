$(function(){function a(){_.prop("disabled",!1),r.data("bootstrapValidator").destroy(),r.data("bootstrapValidator",null),e()}function e(){r.bootstrapValidator({fields:{name:{validators:{notEmpty:{message:"银行通道名称不能为空"}}},app_id:{validators:{notEmpty:{message:"商户平台ID不能为空"}}},app_secret:{validators:{notEmpty:{message:"商户平台secret不能为空"}}},store_id:{validators:{notEmpty:{message:"商户门店ID不能为空"}}}}}).on("success.form.bv",function(a){a.preventDefault();var e=_.data("id"),i=d.val(),s=n.val(),o=l.val(),r=p.val(),u={name:i,app_id:s,app_secret:o,store_id:r};e?(u.id=e,post_url=__BASEURL__+"mshop/fubei_config_api/edit"):post_url=__BASEURL__+"mshop/fubei_config_api/add",_.prop("disabled",!0),$.post(post_url,autoCsrf(u),function(a){_.prop("disabled",!1),c.modal("hide"),a.success?(new Msg({type:"success",msg:a.msg}),t(g)):new Msg({type:"danger",msg:a.msg})})})}function t(a){$.getJSON(__BASEURL__+"mshop/fubei_config_api/list",{current_page:a||1,page_size:b},function(e){if(e.success){var i=e.data,s=Math.ceil(+e.data.total/b);$("#fubeiTbody").html(template(f,i)),laypage({cont:"fubeiPage",pages:s,curr:a||1,skin:"#5aa2e7",first:1,last:s,skip:!0,prev:"&lt",next:"&gt",jump:function(a,e){e||(t(a.curr),g=a.curr)}})}else new Msg({type:"danger",msg:e.msg})})}function i(){a(),d.val(""),n.val(""),l.val(""),p.val(""),_.data("id",""),c.find(".modal-title").text("添加银行通道"),c.modal("show")}function s(e,t,i,s,o){a(),d.val(t),n.val(i),l.val(s),p.val(o),_.data("id",e),c.find(".modal-title").text("修改银行通道"),c.modal("show")}function o(a){m.data("id",a).prop("disabled",!1),u.modal("show")}var d=$("#name"),n=$("#app_id"),l=$("#app_secret"),p=$("#store_id"),r=$("#fubei-form"),u=$("#delFubeiModal"),c=$("#editFubeiModal"),m=$("#del-confirm"),_=$("#edit-confirm"),f=document.getElementById("fubeiTpl").innerHTML,g=1,b=10;e(),t(),m.on("click",function(){var a=$(this).data("id");m.prop("disabled",!0),$.post(__BASEURL__+"mshop/fubei_config_api/delete",autoCsrf({id:a}),function(a){a.success?(new Msg({type:"success",msg:a.msg}),t(g)):new Msg({type:"danger",msg:a.msg}),m.prop("disabled",!1),u.modal("hide")})}),window.addFubei=i,window.editFubei=s,window.delFubei=o});