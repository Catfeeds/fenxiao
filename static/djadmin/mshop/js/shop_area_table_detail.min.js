$(function(){function a(){$.getJSON(__BASEURL__+"mshop/shop_area_api/get_all_area",{shop_id:r},function(a){if(a.success){var e={rows:a.data};a.data.length>0&&$tableShopArea.html(template(shopAreaTpl,e))}})}function e(){$.getJSON(__BASEURL__+"mshop/shop_area_api/area_table_info",{id:table_id},function(a){a.success?$tableDetail.html(template(tableDetailTpl,a.data)):new Msg({type:"danger",msg:a.msg})})}function t(){$editTableModal.modal("show"),$("#table-form").data("bootstrapValidator").destroy(),$("#table-form").data("bootstrapValidator",null),d()}function d(){$("#table-form").bootstrapValidator({fields:{table_shop_area:{validators:{notEmpty:{message:"区域不能为空"}}},table_name:{validators:{notEmpty:{message:"桌位名称不能为空"},stringLength:{max:30,message:"桌位名称不得超过30个字符"}}},table_number:{validators:{notEmpty:{message:"建议人数不能为空"}}}}}).on("success.form.bv",function(a){a.preventDefault();var t,d,o=$editConfirm.data("id"),i=$tableShopArea.val(),l=$tableName.val(),s=$tableNumber.val();d={shop_area_id:i,name:l,number:s},o?(d.id=o,t=__BASEURL__+"mshop/shop_area_api/area_table_edit"):t=__BASEURL__+"mshop/shop_area_api/area_table_add",$editConfirm.prop("disabled",!0),$.post(t,autoCsrf(d),function(a){a.success?(new Msg({type:"success",msg:a.msg}),e()):new Msg({type:"danger",msg:a.msg}),$editConfirm.prop("disabled",!1),$editTableModal.modal("hide")})})}function o(a){$.post(__BASEURL__+"mshop/shop_area_api/regen_qrcode",autoCsrf({id:a}),function(a){a.success?(new Msg({type:"success",msg:"刷新成功"}),e()):new Msg({type:"danger",msg:a.msg})})}function i(a){setTimeout(function(){e()},200),window.open(__BASEURL__+"mshop/shop_area_api/download?id="+a)}function l(a,e,d,o){$editTableModal.find(".modal-title").text("编辑桌位"),$tableShopArea.val(e),$tableName.val(d),$tableNumber.val(o),$editConfirm.data("id",a),t()}function s(a){$delConfirm.data("id",a),$delTableModal.modal("show")}function n(a,e){$auditModal.data("tid",a).data("order_detail_id",e).modal("show")}var r=$("#shop").val();table_id=GetQueryString("table_id"),$editTableModal=$("#editTableModal"),$delTableModal=$("#delTableModal"),$auditModal=$("#auditModal"),$editConfirm=$("#edit-confirm"),$delConfirm=$("#del-confirm"),$auditCancel=$("#audit-cancel"),$auditConfirm=$("#audit-confirm"),$tableShopArea=$("#table_shop_area"),$tableName=$("#table_name"),$tableNumber=$("#table_number"),$tableDetail=$("#table-detail"),$orderDetail=$("#order-detail"),shopAreaTpl=document.getElementById("shopAreaTpl").innerHTML,tableDetailTpl=document.getElementById("tableDetailTpl").innerHTML,a(),e(),d(),$delConfirm.on("click",function(){var a=$(this).data("id");$delConfirm.prop("disabled",!0),$.post(__BASEURL__+"mshop/shop_area_api/area_table_del",autoCsrf({id:a}),function(a){a.success?(new Msg({type:"success",msg:"删除成功"}),window.location.href=__BASEURL__+"mshop/shop_area/table/"+r):new Msg({type:"danger",msg:a.msg}),$delConfirm.prop("disabled",!1),$delTableModal.modal("hide")})}),$auditCancel.on("click",function(){var a=$auditModal.data("tid"),t=$auditModal.data("order_detail_id");$auditCancel.prop("disabled",!0).text("提交中"),$.post(__BASEURL__+"mshop/meal_order_api/refuse_order",autoCsrf({tid:a,order_table_id:t}),function(a){$auditModal.modal("hide"),$auditCancel.prop("disabled",!1).text("拒单"),a.success?(e(),new Msg({type:"success",msg:a.msg})):new Msg({type:"danger",msg:a.msg})})}),$auditConfirm.on("click",function(){var a=$auditModal.data("tid"),t=$auditModal.data("order_detail_id");$auditConfirm.prop("disabled",!0).text("提交中"),$.post(__BASEURL__+"mshop/meal_order_api/audit_order",autoCsrf({tid:a,order_table_id:t}),function(a){$auditModal.modal("hide"),$auditConfirm.prop("disabled",!1).text("接单"),a.success?(e(),new Msg({type:"success",msg:a.msg})):new Msg({type:"danger",msg:a.msg})})}),window.editTable=l,window.delTable=s,window.refreshQrcode=o,window.downloadQrcode=i,window.auditOrder=n});