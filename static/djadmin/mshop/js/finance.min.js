$(function(){function e(){function e(e,a){Y=e.format("YYYY-MM-DD")+" - "+a.format("YYYY-MM-DD"),c.val(Y),t(y)}c.daterangepicker({startDate:g,endDate:u,maxDate:u,applyClass:"btn-primary",cancelClass:"btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],firstDay:1,format:"YYYY-MM-DD"},ranges:{"今日":[moment(),moment()],"昨日":[moment().subtract(1,"days"),moment().subtract(1,"days")],"最近7日":[moment().subtract(6,"days"),moment()],"最近30日":[moment().subtract(29,"days"),moment()]}},e)}function a(){$.getJSON(__BASEURL__+"mshop/finance_api/info",{shop_id:h},function(e){e.success?($("#account-money").text(parseFloat(Number(e.data.money)-Number(e.data.on_money)).toFixed(2)),$("#on-money").text(e.data.on_money)):new Msg({type:"danger",msg:e.msg})})}function t(e){$.getJSON(__BASEURL__+"mshop/finance_api/moeny_record_list",{current_page:e||1,page_size:_,shop_id:h,pay_type:w,time:Y},function(a){if(a.success){var n=Math.ceil(+a.data.total/_);$("#financeTbody").html(template(f,a.data)),laypage({cont:"financePage",pages:n,curr:e||1,skin:"#5aa2e7",first:1,last:n,skip:!0,prev:"&lt",next:"&gt",jump:function(e,a){a||(y=e.curr,t(e.curr))}})}else new Msg({type:"danger",msg:a.msg})})}var n=$("#shop"),o=$("#type"),c=$("#time"),s=$("#btn-withdraw"),r=$("#confirm-withdraw"),i=$("#cancel-withdraw"),m=$("#withdraw-money"),p=$("#withdraw-form"),l=$("#export-finance"),d=+m.attr("max"),f=document.getElementById("financeTpl").innerHTML,g=moment().subtract(29,"days"),u=moment(),y=1,_=10,h=n.val(),w=o.val(),Y=g.format("YYYY-MM-DD")+" - "+u.format("YYYY-MM-DD");e(),a(),t(),n.on("change",function(){h=$(this).val(),a(1),t(1)}),o.on("change",function(){w=$(this).val(),t(1)}),s.on("click",function(){p.show()}),i.on("click",function(){p.hide()}),m.on("keyup",function(){var e=m.val().replace(/[^\d.]/g,"").replace(/^\./g,"").replace(/\.{2,}/g,".").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3");+e>d?m.val(d):m.val(e)}),r.on("click",function(){var e=m.val();return""===e?(new Msg({type:"danger",msg:"输入提现金额"}),!1):+e<=0?(new Msg({type:"danger",msg:"提现金额必须大于0"}),!1):(r.prop("disabled",!0).text("提交中..."),void $.post(__BASEURL__+"mshop/finance_api/withdraw",autoCsrf({money:e}),function(e){e.success?(new Msg({type:"success",msg:e.msg,delay:1}),window.location.reload()):new Msg({type:"danger",msg:e.msg}),r.prop("disabled",!1).text("确定")}))}),l.on("click",function(){window.open(__BASEURL__+"mshop/finance_api/money_record_export?shop_id="+h+"&pay_type="+w+"&time="+Y)})});