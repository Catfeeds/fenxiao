$(function(){function o(t){$.getJSON(__BASEURL__+"mshop/shop_api/list",{current_page:t||1,page_size:c},function(a){if(a.success){var e=Math.ceil(+a.data.total/c);m=a.data.total,$("#shopTbody").html(template(p,a.data)),laypage({cont:"shopPage",pages:e,curr:t||1,skin:"#5aa2e7",first:1,last:e,skip:!0,prev:"&lt",next:"&gt",jump:function(t,a){a||(o(t.curr),l=t.curr)}})}})}function t(){$.getJSON(__BASEURL__+"mshop/shop_api/noref_list",{current_page:1,page_size:20},function(o){o.success&&(_=o.data.list,$("#mainShopTbody").html(template(d,o.data)))})}function a(){m<h?_.length>0?$("#mainShopModal").modal("show"):window.location.href=__BASEURL__+"mshop/shop/add":$("#shopLimitModal").modal("show")}function e(o){n.data("id",o),s.modal("show")}var s=$("#delShopModal"),n=$("#del-confirm"),i=$("#shop_limit"),p=document.getElementById("shopTpl").innerHTML,d=document.getElementById("mainShopTpl").innerHTML,l=1,c=10,h=+i.val(),m=0,_=[];o(),t(),n.on("click",function(){var t=$(this).data("id");n.prop("disabled",!0),$.post(__BASEURL__+"mshop/shop_api/del",autoCsrf({shop_id:t}),function(t){n.prop("disabled",!1),s.modal("hide"),t.success?(new Msg({type:"success",msg:"删除成功"}),o(l)):new Msg({type:"danger",msg:t.msg})})}),window.addShop=a,window.delShop=e});