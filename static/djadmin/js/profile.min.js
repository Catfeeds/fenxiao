$(function(){function s(){$.getJSON(__BASEURL__+"user_api/info",function(s){s.success?e(s.data):new Msg({type:"danger",msg:s.msg})})}function e(s){s.img&&n.attr("src",__UPLOADURL__+s.img),d.text(s.mobile),i.text(s.username),$("#nick").val(s.username),s.sex?(p.text(s.sex),$('[name="sex"][value="'+s.sex+'"]').prop("checked",!0)):(p.text("保密"),$('[name="sex"][value="保密"]').prop("checked",!0))}function a(s){return!!s&&void $.post(__BASEURL__+"user_api/edit",autoCsrf({field:"img",value:s}),function(e){e.success?(new Msg({type:"success",msg:"修改成功"}),n.attr("src",__UPLOADURL__+s)):new Msg({type:"danger",msg:e.msg})})}function o(){$("#nick-form").bootstrapValidator({fields:{nick:{validators:{notEmpty:{message:"昵称不能为空"},stringLength:{max:10,message:"昵称不能超过10个字符"}}}}}).on("success.form.bv",function(s){s.preventDefault();var e=$("#nick").val();g.prop("disabled",!0),$.post(__BASEURL__+"user_api/edit",autoCsrf({field:"username",value:e}),function(s){s.success?(new Msg({type:"success",msg:"修改成功"}),u.modal("hide"),i.text(e)):new Msg({type:"danger",msg:s.msg}),g.prop("disabled",!1)})})}function t(){$("#password-form").bootstrapValidator({fields:{old_password:{validators:{notEmpty:{message:"旧密码不能为空"},stringLength:{min:6,max:25,message:"密码格式不正确"}}},new_password:{validators:{notEmpty:{message:"新密码不能为空"},regexp:{regexp:PregRule.Pwd,message:"请使用字母、数字和符号的密码组合，8-25个字符"}}},re_password:{validators:{notEmpty:{message:"确认密码不能为空"},identical:{field:"new_password",message:"两次输入密码不一致"}}}}}).on("success.form.bv",function(s){s.preventDefault();var e=$("#old_password").val(),a=$("#new_password").val(),o=$("#re_password").val();w.prop("disabled",!0),$.post(__BASEURL__+"user_api/update_password",autoCsrf({old_password:e,new_password:a,re_password:o}),function(s){s.success?(new Msg({type:"success",msg:"修改成功"}),f.modal("hide")):new Msg({type:"danger",msg:s.msg}),w.prop("disabled",!1)})})}function r(){$("#sex-form").bootstrapValidator({fields:{sex:{validators:{notEmpty:{message:"性别不能为空"}}}}}).on("success.form.bv",function(s){s.preventDefault();var e=$('[name="sex"]:checked').val();v.prop("disabled",!0),$.post(__BASEURL__+"user_api/edit",autoCsrf({field:"sex",value:e}),function(s){s.success?(new Msg({type:"success",msg:"修改成功"}),p.text(e),_.modal("hide")):new Msg({type:"danger",msg:s.msg}),v.prop("disabled",!1)})})}var n=$("#profile-avatar"),d=$("#profile-phone"),i=$("#profile-nick"),p=$("#profile-sex"),l=$("#edit-nick"),c=$("#edit-password"),m=$("#edit-sex"),u=$("#nickModal"),f=$("#passwordModal"),_=$("#sexModal"),g=$("#confirm-nick"),w=$("#confirm-password"),v=$("#confirm-sex");s(),uploadFile("main_header",{browse_button:"upload-avatar",container:"upload-avatar-container",drop_element:"upload-avatar-container",max_file_size:"10mb",chunk_size:"4mb",init:{FileUploaded:function(s,e,o){var t=JSON.parse(o.response),r=t.key;a(r)}}}),l.on("click",function(){$("#nick-form").data("bootstrapValidator").destroy(),$("#nick-form").data("bootstrapValidator",null),o(),u.modal("show")}),c.on("click",function(){$("#password-form").data("bootstrapValidator").destroy(),$("#password-form").data("bootstrapValidator",null),t(),$("#old_password").val(""),$("#new_password").val(""),$("#re_password").val(""),f.modal("show")}),m.on("click",function(){$("#sex-form").data("bootstrapValidator").destroy(),$("#sex-form").data("bootstrapValidator",null),r(),_.modal("show")}),o(),t(),r()});