(function(t,e,r){function i(t,r){this.scroller=e.querySelector(t),this.childNode=this.scroller.childNodes[0],this.options={step:!0,defaultPlace:0,callback:null},this.startPageY=0,this.startTime=0,this.endTime=0,this.offsetTop=0,this.scrollerHeight=this.scroller.clientHeight,this.childNodeHeight=this.childNode.clientHeight,this.scrollHeight=this.childNodeHeight-this.scrollerHeight;var i=this.childNode.childNodes;this.stepLen=i.length>0?i[0].clientHeight:0;for(var s in r)this.options[s]=r[s];var o=this.options.defaultPlace?this.options.defaultPlace:0;this.scrollTo(0,o),this._start(),this._move(),this._end()}function s(t){this.dataListTwo=null,this.arrayDepth=1,this.scrollArray=[],this.textArray=[],this.isScrollTo=!1,this.options={title:"请选择",defaultValue:"",type:"",data:[],keys:null,callBack:null};for(var e in t)this.options[e]=t[e];if(this.options.keys||!(this.options.data.length<=0)){!this.options.type||this.options.type>3||this.options.type<1?this.getArrayDepth(t.data):this.arrayDepth=this.options.type;var r=this.options.keys;if(this.keyId=r.id,this.keyValue=r.value,this.keyData=r.childData,this.defaultArray=["","",""],this.options.defaultValue){var i=this.options.defaultValue,s=i.split(" ");if(s.length>0)for(var o=0;o<s.length;o++)this.defaultArray[o]=s[o]}this.FillData(),this.eventClick()}}i.prototype={_start:function(){var t=this;t.scroller.addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),t.startTime=t.getTime();var r=e.touches?e.touches[0]:e;t.startPageY=r.pageY,t.browserVendor("transition","none")},!1)},_move:function(){var t=this;t.scroller.addEventListener("touchmove",function(e){e.stopPropagation(),e.preventDefault();var i=t.getTime(),s=e.touches?e.touches[0]:e,o=s.pageY-t.startPageY,a=o+t.offsetTop;i-t.endTime>300&&r.abs(o)<10||(a>0?a/=3:r.abs(a)>r.abs(t.scrollHeight)&&(a=r.abs(t.scrollHeight)-r.abs(a),a=a/3-t.scrollHeight),t.browserVendor("transform","translate(0, "+a+"px)"))},!1)},_end:function(){var t=this;t.scroller.addEventListener("touchend",function(e){e.stopPropagation(),e.preventDefault(),t.endTime=t.getTime();var i=t.endTime-t.startTime,s=e.changedTouches?e.changedTouches[0]:e,o=s.pageY-t.startPageY;if(t.offsetTop+=o,t.offsetTop>0||r.abs(t.offsetTop)>r.abs(t.scrollHeight))t.browserVendor("transition","all 500ms");else if(i<300){var a=r.abs(o)/i,l=i*a*20;l=l>2e3?2e3:l,t.offsetTop+=o*a*10,t.browserVendor("transitionProperty","all"),t.browserVendor("transitionDuration",l+"ms"),t.browserVendor("transitionTimingFunction","cubic-bezier(0.1, 0.57, 0.1, 1)")}else t.browserVendor("transition","all 500ms");if(t.offsetTop>0?t.offsetTop=0:r.abs(t.offsetTop)>r.abs(t.scrollHeight)&&(t.offsetTop=-t.scrollHeight),t.options.step&&t.stepLen>0){var n=t.offsetTop,h=r.abs(n%t.stepLen),c=t.stepLen/2,d=h>=c?n-t.stepLen+h:n+h,p=parseInt(r.abs(d)/t.stepLen);t.options.callback({index:p,node:t.childNode.childNodes}),t.offsetTop=d}t.browserVendor("transform","translate(0, "+t.offsetTop+"px)")},!1)},scrollTo:function(t,e,r){var i=this;r&&r>0?(i.browserVendor("transitionProperty","all"),i.browserVendor("transitionDuration",r+"ms"),i.browserVendor("transitionTimingFunction","cubic-bezier(0.1, 0.57, 0.1, 1)")):i.browserVendor("transition","none"),e=-e,i.offsetTop=e,i.browserVendor("transform","translate(0, "+e+"px)")},refresh:function(){this.childNode=this.scroller.childNodes[0],this.startPageY=0,this.startTime=0,this.endTime=0,this.offsetTop=0,this.scrollerHeight=this.scroller.clientHeight,this.childNodeHeight=this.childNode.clientHeight,this.scrollHeight=this.childNodeHeight-this.scrollerHeight;var t=this.childNode.childNodes;this.stepLen=t.length>0?t[0].clientHeight:0,this.scrollTo(0,0,500)},browserVendor:function(t,e){for(var r,i=this,s=["t","WebkitT","MozT","msT","OT"],o=s.length,a=i.childNode.style,l=0;l<o;l++)r=s[l]+t.substr(1),r in a&&(a[r]=e)},getTime:function(){return parseInt((new Date).getTime())}},s.prototype={FillData:function(){var t=this;t.enterNodesBlur();var r=e.querySelector(".zx_mask");r&&e.body.removeChild(r);var i=t.options.title?t.options.title:"请选择",s=e.createElement("div");s.className="zx_mask";var o='<div class="zx_select showPicker"><header><button class="nav_left picker-cancel">取消</button><h1>'+i+'</h1><button class="nav_right picker-ok">确定</button></header><div class="ub"><div class="ub-f1 picker-wrapper" id="picker-wrapper0"><ul></ul></div>';t.arrayDepth>=2&&(o+='<div class="ub-f1 picker-wrapper" id="picker-wrapper1"><ul></ul></div>'),t.arrayDepth>=3&&(o+='<div class="ub-f1 picker-wrapper" id="picker-wrapper2"><ul></ul></div>'),o+='<div class="sel_top"></div><div class="sel_bottom"></div>',o+='<div class="sel_middle"></div></div></div>',s.innerHTML=o,e.body.appendChild(s);for(var a=parseFloat(100/t.arrayDepth).toFixed(3)+"%",l=e.querySelectorAll(".picker-wrapper"),n=0;n<l.length;n++)l[n].style.minWidth=a,l[n].style.maxWidth=a;t.arrayDepth>=1&&t.showScrollList(this.options.data,0,!0)},scrollInit:function(t,r){var s=this,o=e.querySelector("#picker-wrapper0").childNodes[0],a=o.childNodes[0].clientHeight,l="#picker-wrapper"+t;s.scrollArray[t]=new i(l,{step:a,defaultPlace:a*r,callback:function(e){var r=e.index+2,i=e.node[r];s.SetItemList(i,t)}}),s.add_EventListen()},SetItemList:function(t,e){var r=this;if(t){var i=r.keyId,s=r.keyValue,o={};o[s]=t.textContent,o[i]=t.attributes[0].value,r.defaultArray=["","",""],0==e?(r.defaultArray[e]=o[s],r.showScrollList(r.options.data,0)):1==e&&(r.defaultArray[e]=o[s],r.showScrollList(r.dataListTwo,1))}else var o="";r.textArray[e]=o},showScrollList:function(t,r,i){var s,o=this,a=o.keyId,l=o.keyValue,n=o.keyData,h="<li></li><li></li>",c=[];if(o.defaultArray[r]){for(var d=!1,p=0;p<t.length;p++)o.defaultArray[r]&&o.defaultArray[r]==t[p][l]&&(d=!0,s=p,n&&t[p][n]&&(c=t[p][n]),o.setDefaultItem(r,t[p][l],t[p][a])),h+='<li data-id="'+t[p][a]+'">'+t[p][l]+"</li>";d||(n&&t[0][n]&&(c=t[0][n]),o.setDefaultItem(r,t[0][l],t[0][a]))}else{for(var p=0;p<t.length;p++)h+='<li data-id="'+t[p][a]+'">'+t[p][l]+"</li>";n&&t[0][n]&&(c=t[0][n]),o.setDefaultItem(r,t[0][l],t[0][a])}h+="<li></li><li></li>",e.querySelector("#picker-wrapper"+r).childNodes[0].innerHTML=h;var u=r+1;i?(o.scrollInit(r,s),u<o.arrayDepth&&c.length>0&&o.showScrollList(c,u,!0)):u<o.arrayDepth&&(c.length>0&&o.showScrollList(c,u),setTimeout(function(){o.scrollArray[u].refresh()},0)),0==r&&(o.dataListTwo=c)},setDefaultItem:function(t,e,r){var i=this,s=i.keyId,o=i.keyValue,a={};a[o]=e,a[s]=r,i.textArray[t]=a},eventClick:function(){var t=this;e.querySelector(".picker-cancel").addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault(),t.HidePicker()}),e.querySelector(".picker-ok").addEventListener("touchstart",function(e){e.stopPropagation(),e.preventDefault();for(var r="",i="",s=t.options.keys,o=0;o<t.textArray.length;o++){var a=s.id,l=s.value;0==o?(r+=t.textArray[o][l],i+=t.textArray[o][a]):(r+=" "+t.textArray[o][l],i+=","+t.textArray[o][a])}t.options.callBack&&t.options.callBack(r,i),t.HidePicker()})},HidePicker:function(){var t=this;e.querySelector(".zx_select").style.height="0",t.remove_EventListen(),setTimeout(function(){var r=e.querySelector(".zx_mask");e.body.removeChild(r),t.destroy()},200)},getArrayDepth:function(t){var e=this,r=t[0],i="";for(var s in r)if(Array.isArray(r[s])&&0!=r[s].length){i=s,e.arrayDepth++;break}i&&e.getArrayDepth(r[i])},enterNodesBlur:function(){for(var t=e.querySelectorAll("input"),r=0;r<t.length;r++)t[r].blur();for(var i=e.querySelectorAll("textarea"),s=0;s<i.length;s++)i[s].blur()},touchDefault:function(t){t.preventDefault()},touchStop:function(t){t.stopPropagation(),t.preventDefault()},add_EventListen:function(){var t=this;e.addEventListener("touchmove",t.touchDefault,!1)},remove_EventListen:function(){var t=this;e.removeEventListener("touchmove",t.touchDefault,!1)},destroy:function(){var t=this;t.dataListTwo=null,t.options=null,t.arrayDepth=1,t.scrollArray=[],t.textArray=[],t.isScrollTo=!1,this.keyId="",this.keyValue="",this.keyData="",this.defaultArray=["","",""]}},"undefined"!=typeof module&&module.exports?module.exports=s:t.Picker=s})(window,document,Math);